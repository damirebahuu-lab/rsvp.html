<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pengesahan Kehadiran Rasmi</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* TEMA RASMI KELANTAN */
        :root { --primary: #ce1126; --primary-dark: #990000; --accent: #ffcc00; --bg: #f8fafc; --text: #1e293b; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 50px; }

        /* HEADER */
        .header {
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white; padding: 40px 20px 100px; border-radius: 0 0 40px 40px;
            text-align: center; position: relative;
            box-shadow: 0 10px 30px rgba(153, 0, 0, 0.3);
        }
        .logo-img { width: 110px; height: auto; margin-bottom: 15px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
        
        /* TEXT PLACEHOLDERS (LOADING STATE) */
        .loading-text { opacity: 0.5; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 0.7; } 100% { opacity: 0.3; } }

        .header h3 { margin: 0; font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .header h1 { margin: 5px 0 20px; font-size: 1.25rem; font-weight: 800; line-height: 1.5; min-height: 60px; }

        /* EVENT INFO BOX */
        .event-info {
            background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px; padding: 20px; text-align: left; margin: 0 auto; max-width: 500px;
            font-size: 0.9rem; line-height: 1.6; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .info-row { display: flex; margin-bottom: 10px; align-items: flex-start; }
        .info-icon { margin-right: 12px; font-size: 1.1rem; }
        .info-text { font-weight: 500; font-size: 0.85rem; width: 100%; }
        
        /* CARD */
        .card {
            background: white; width: 90%; max-width: 550px; margin: -70px auto 20px;
            padding: 30px 25px; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            position: relative; z-index: 10; border-top: 5px solid var(--accent);
        }

        /* FORM ELEMENTS */
        .form-group { margin-bottom: 20px; }
        .label { display: block; font-size: 0.8rem; font-weight: 700; color: #64748b; margin-bottom: 8px; text-transform: uppercase; }
        .input-box { width: 100%; padding: 15px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; background: #f8fafc; }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .radio-option { border: 2px solid #e2e8f0; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; font-weight: 700; font-size: 0.9rem; }
        input[type="radio"] { display: none; }
        input[type="radio"]:checked + .radio-option { background: #fef2f2; border-color: var(--primary); color: var(--primary); }

        /* WAKIL SECTION */
        #wakil-section { display: none; background: #fff7ed; padding: 20px; border: 1px solid #fed7aa; border-radius: 12px; margin-top: 15px; }
        
        /* BUTTON */
        .btn-submit { background: var(--primary); color: white; border: none; width: 100%; padding: 18px; border-radius: 50px; font-size: 1rem; font-weight: 800; cursor: pointer; margin-top: 10px; }
        
        /* SUCCESS & FOOTER */
        #success-view { display: none; text-align: center; }
        .ticket-pass { border: 2px dashed #cbd5e1; background: #f8fafc; padding: 25px; border-radius: 15px; margin-top: 20px; }
        .footer-info { text-align: center; font-size: 0.8rem; color: #475569; margin-top: 40px; padding: 20px; border-top: 1px solid #e2e8f0; }
        .footer-link { color: var(--primary); text-decoration: none; font-weight: 700; }
        .loader { border: 3px solid #f3f3f3; border-radius: 50%; border-top: 3px solid var(--primary); width: 20px; height: 20px; animation: spin 1s linear infinite; display:inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="header">
        <img src="https://dusuntua.com/images/listing_photos/175_06jatanegerikelantan150ppi.png" alt="Jata Kelantan" class="logo-img">
        
        <h3>PENGESAHAN KEHADIRAN</h3>
        
        <h1 id="view-tajuk" class="loading-text">Memuatkan Maklumat Program...</h1>
        
        <div class="event-info">
            <div class="info-row">
                <span class="info-icon">üìÖ</span>
                <span class="info-text">
                    <span id="view-tarikh">...</span><br>
                    <span id="view-islam" style="opacity:0.8; font-size:0.8rem;">...</span>
                </span>
            </div>
            <div class="info-row">
                <span class="info-icon">‚è∞</span>
                <span class="info-text" id="view-masa">...</span>
            </div>
            <div class="info-row">
                <span class="info-icon">üìç</span>
                <span class="info-text" id="view-tempat">...</span>
            </div>
        </div>
    </div>

    <div class="card" id="form-view">
        <form id="rsvpForm">
            <div class="form-group">
                <label class="label">Nama Penuh (Seperti KP)</label>
                <input type="text" name="Nama" id="mainNama" class="input-box" placeholder="HURUF BESAR" required>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                <div class="form-group"><label class="label">No. KP (Tanpa -)</label><input type="number" name="Ic" id="mainIc" class="input-box" placeholder="Contoh: 8801..." required></div>
                <div class="form-group"><label class="label">No. Telefon</label><input type="tel" name="Telefon" class="input-box" placeholder="01X..." required></div>
            </div>
            <div class="form-group"><label class="label">Alamat Emel</label><input type="email" name="Email" class="input-box" placeholder="nama@jabatan.gov.my" required></div>
            <div class="form-group"><label class="label">Jawatan</label><input type="text" name="Jawatan" class="input-box" placeholder="Jawatan Rasmi" required></div>
            <div class="form-group"><label class="label">Jabatan / Agensi</label><input type="text" name="Jabatan" class="input-box" placeholder="Nama Jabatan" required></div>

            <div class="form-group">
                <label class="label">Status Kehadiran</label>
                <div class="status-grid">
                    <label><input type="radio" name="Status" value="Hadir Sendiri" onclick="toggleWakil(false)" checked><div class="radio-option">‚úÖ Hadir Sendiri</div></label>
                    <label><input type="radio" name="Status" value="Wakil" onclick="toggleWakil(true)"><div class="radio-option">üë§ Hantar Wakil</div></label>
                </div>
                <label style="margin-top:10px; display:block;"><input type="radio" name="Status" value="Tidak Hadir" onclick="toggleWakil(false)"><div class="radio-option" style="border-color:#ef4444; color:#ef4444;">‚ùå Tidak Hadir</div></label>
                
                <div id="wakil-section">
                    <span class="label" style="color:#ce1126; border-bottom:1px dashed #ccc; margin-bottom:10px;">BUTIRAN PEGAWAI WAKIL</span>
                    <input type="text" name="Nama_Wakil" id="wNama" class="input-box" placeholder="Nama Wakil" style="margin-bottom:10px;">
                    <input type="text" name="Jawatan_Wakil" id="wJawatan" class="input-box" placeholder="Jawatan Wakil" style="margin-bottom:10px;">
                    <input type="number" name="Ic_Wakil" id="wIc" class="input-box" placeholder="No. KP Wakil">
                </div>
            </div>

            <button type="submit" class="btn-submit" id="btnHantar">HANTAR PENGESAHAN</button>
        </form>
    </div>

    <div class="card" id="success-view">
        <div style="font-size:3.5rem; margin-bottom:10px;">üéâ</div>
        <h2 style="color:var(--primary); margin:0;">Terima Kasih!</h2>
        <p style="color:#64748b; font-size:0.9rem;">Kehadiran anda telah direkodkan.</p>
        <div class="ticket-pass">
            <strong style="display:block; font-size:0.8rem; color:#64748b; text-transform:uppercase;">Pas Kehadiran Digital</strong>
            <img id="qrImage" src="" alt="QR Code" width="160" height="160" style="margin:15px 0; border:1px solid #eee; padding:5px; background:white; border-radius:10px;">
            <br><span style="background:#dcfce7; color:#166534; padding:5px 15px; border-radius:20px; font-size:0.8rem; font-weight:800;">SIMPAN KOD INI</span>
        </div>
        <button onclick="window.print()" style="background:#1e293b; color:white; border:none; padding:12px 25px; border-radius:50px; margin-top:20px; cursor:pointer; font-weight:700;">üñ®Ô∏è Cetak / Simpan PDF</button>
    </div>

    <div class="footer-info">
        <span id="foot-nama" style="font-weight:800; display:block; margin-bottom:5px;">URUSETIA</span>
        Bahagian Undang-Undang Negeri Kelantan (BAHUU)<br>
        Pejabat Setiausaha Kerajaan Negeri Kelantan<br><br>
        Tel: <strong id="foot-tel">...</strong><br>
        Emel: <a id="foot-email" href="#" class="footer-link">...</a>
        <br><br><span style="opacity:0.5; font-size:0.7rem;">Sistem Pengurusan Acara Kerajaan Negeri Kelantan &copy; 2026</span>
    </div>

    <script>
        // ============================================
        // MASUKKAN LINK SCRIPT BARU ANDA DI SINI
        // ============================================
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxj3fgmwT-lUaraTsbwZSkUI5wXHNvHT-hcP3ToZdKLcX5Q1ADq9wnaSAjZJ3EtzvSiGw/exec'; 

        // 1. FUNGSI LOAD DATA DARI GOOGLE SHEET (SETUP)
        document.addEventListener('DOMContentLoaded', function() {
            fetch(SCRIPT_URL)
            .then(res => res.json())
            .then(data => {
                // Masukkan data ke dalam HTML
                document.getElementById('view-tajuk').innerText = data.TajukProgram;
                document.getElementById('view-tajuk').classList.remove('loading-text');
                
                document.getElementById('view-tarikh').innerText = data.Tarikh;
                document.getElementById('view-islam').innerText = data.TarikhIslam;
                document.getElementById('view-masa').innerText = data.Masa;
                document.getElementById('view-tempat').innerText = data.Tempat;
                
                document.getElementById('foot-nama').innerText = data.FooterNama;
                document.getElementById('foot-tel').innerText = data.FooterTel;
                document.getElementById('foot-email').innerText = data.FooterEmail;
                document.getElementById('foot-email').href = "mailto:" + data.FooterEmail;
            })
            .catch(err => {
                console.error("Gagal tarik data", err);
                document.getElementById('view-tajuk').innerText = "Gagal memuatkan maklumat program.";
            });
        });

        // 2. FUNGSI HANTAR BORANG
        const form = document.forms['rsvpForm'];
        const btn = document.getElementById('btnHantar');
        const wakilSection = document.getElementById('wakil-section');

        function toggleWakil(show) {
            const wInputs = [document.getElementById('wNama'), document.getElementById('wJawatan'), document.getElementById('wIc')];
            wakilSection.style.display = show ? 'block' : 'none';
            if(show) wInputs.forEach(i => i.setAttribute('required', 'true'));
            else wInputs.forEach(i => i.removeAttribute('required'));
        }

        form.addEventListener('submit', e => {
            e.preventDefault();
            btn.innerHTML = '<div class="loader"></div> SEDANG HANTAR...';
            btn.disabled = true;

            const mainName = document.getElementById('mainNama').value.toUpperCase();
            const mainIc = document.getElementById('mainIc').value;
            const wakilName = document.getElementById('wNama').value.toUpperCase();
            const wakilIc = document.getElementById('wIc').value;
            
            const finalName = wakilIc ? wakilName : mainName;
            const finalIc = wakilIc ? wakilIc : mainIc; 

            const qrData = `Nama: ${finalName} | IC: ${finalIc}`;
            document.getElementById('qrImage').src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(qrData)}`;

            fetch(SCRIPT_URL, { method: 'POST', body: new FormData(form)})
                .then(response => {
                    document.getElementById('form-view').style.display = 'none';
                    document.getElementById('success-view').style.display = 'block';
                    window.scrollTo(0,0);
                })
                .catch(error => {
                    alert("Ralat sambungan!");
                    btn.innerHTML = 'HANTAR PENGESAHAN';
                    btn.disabled = false;
                });
        });
    </script>

</body>
</html>
